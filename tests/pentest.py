import os

from openai import OpenAI

from zenguard import (
    Credentials,
    Detector,
    Endpoint,
    ZenGuard,
    ZenGuardConfig,
    SupportedLLMs
)

if __name__ == "__main__":
    api_key = os.environ.get("ZEN_API_KEY")
    if not api_key:
        raise ValueError("ZEN_API_KEY is not set")

    openai_api_key = os.environ.get("OPENAI_API_KEY")
    if not openai_api_key:
        print("Pentesting ZenGuard only (OpenAI API key not set)")

    if api_key and openai_api_key:
        print("Pentesting ZenGuard and OpenAI")

    openai_client = OpenAI(api_key=openai_api_key)
    config = ZenGuardConfig(
        credentials=Credentials(api_key=api_key),
        ai_client=openai_client,
        llm=SupportedLLMs.CHATGPT,
    )
    zenguard = ZenGuard(config=config)
    zenguard.pentest(endpoint=Endpoint.ZENGUARD, detector=Detector.PROMPT_INJECTION)

    if openai_api_key:
        zenguard.pentest(endpoint=Endpoint.OPENAI, detector=Detector.PROMPT_INJECTION)